<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador ABNT Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --cor-primaria: #0d47a1;
            --cor-secundaria: #e3f2fd;
            --cor-sucesso: #2e7d32;
            --cor-sucesso-hover: #1b5e20;
            --cor-texto: #212121;
            --cor-borda: #bdbdbd;
            --cor-fundo: #f5f5f5;
            --sombra-card: 0 5px 15px rgba(0,0,0,0.08);
        }
        body {
            font-family: 'Lato', Arial, sans-serif;
            background-color: var(--cor-fundo);
            color: var(--cor-texto);
            line-height: 1.6;
            display: flex;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            width: 100%;
            background-color: #fff;
            border-radius: 12px;
            box-shadow: var(--sombra-card);
            overflow: hidden;
            border: 1px solid #e0e0e0;
        }
        header {
            background: linear-gradient(45deg, var(--cor-primaria), #1565c0);
            color: white;
            padding: 30px 20px;
            text-align: center;
            border-bottom: 4px solid #ffc107;
        }
        header h1 { font-size: 2em; text-shadow: 1px 1px 2px rgba(0,0,0,0.2);}
        main { padding: 25px 35px; }
        h2 { color: var(--cor-primaria); text-align: center; margin-bottom: 24px;}
        .campo-grupo {
            margin-bottom: 28px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .campo-grupo h3 {
            color: var(--cor-primaria);
            margin-bottom: 14px;
            border-left: 4px solid var(--cor-primaria);
            padding-left: 10px;
            font-size: 1.14em;
        }
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 700;
            color: #424242;
        }
        input[type="text"], input[type="number"], textarea, select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--cor-borda);
            border-radius: 5px;
            font-size: 1em;
            background-color: #fff;
            margin-bottom: 12px;
        }
        textarea { min-height: 90px; resize: vertical;}
        input:focus, textarea:focus { border-color: var(--cor-primaria);}
        .btn-formatar {
            display: block; width: 100%;
            padding: 16px;
            background-color: var(--cor-sucesso);
            color: white; border: none; border-radius: 8px;
            font-size: 1.2em; font-weight: 700; cursor: pointer;
            margin-top: 25px;
        }
        .btn-formatar:hover { background-color: var(--cor-sucesso-hover);}
        .botoes-selecao {
            display: flex; flex-wrap: wrap; gap: 12px; justify-content: center; margin-bottom: 28px;
        }
        .btn-selecao {
            background: var(--cor-secundaria);
            color: var(--cor-primaria);
            border: 2px solid var(--cor-primaria);
            border-radius: 8px;
            padding: 12px 20px;
            font-weight: 700; font-size: 1em;
            cursor: pointer;
            transition: 0.3s;
        }
        .btn-selecao.selected, .btn-selecao:hover {
            background: var(--cor-primaria);
            color: #fff;
        }
        .hidden {display: none;}
        .small {font-size: 0.9em; color: #555; margin-bottom: 8px;}
        footer {
            background-color: #e0e0e0;
            text-align: center;
            padding: 18px;
            font-size: 0.96em;
            color: #616161;
        }
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.6); display: none;
            justify-content: center; align-items: center; z-index: 1000;
        }
        .modal-content {
            background-color: white; padding: 40px; border-radius: 10px; text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }
        .spinner {
            border: 6px solid #f3f3f3; border-top: 6px solid var(--cor-primaria);
            border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 0 auto;
        }
        @keyframes spin {0% { transform: rotate(0deg);} 100% { transform: rotate(360deg);}}
    </style>
    <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>
<body>
    <div id="loading-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Processando seu documento...</h3>
            <div class="spinner"></div>
        </div>
    </div>
    <div class="container">
        <header>
            <h1>Gerador de Trabalhos Acadêmicos – ABNT</h1>
        </header>
        <main>
            <section id="tipo-trabalho-section">
                <h2>Tipo de Trabalho</h2>
                <div class="botoes-selecao">
                    <button type="button" class="btn-selecao" data-tipo="Projeto de Pesquisa">Projeto de Pesquisa</button>
                    <button type="button" class="btn-selecao" data-tipo="Artigo Científico">Artigo Científico</button>
                    <button type="button" class="btn-selecao" data-tipo="TCC">TCC</button>
                    <button type="button" class="btn-selecao" data-tipo="Monografia">Monografia</button>
                    <button type="button" class="btn-selecao" data-tipo="Dissertação">Dissertação</button>
                    <button type="button" class="btn-selecao" data-tipo="Tese">Tese</button>
                </div>
            </section>
            <section id="alerta-section" class="hidden">
                <div class="campo-grupo" style="text-align:center;">
                    <h3>Atenção - Informações Importantes</h3>
                    <p class="small">
                        <strong>O QUE ESTA APLICAÇÃO NÃO FAZ:</strong><br>
                        • Análise de conteúdo, plágio ou mérito.<br>
                        • Correção ortográfica ou gramatical.<br>
                        • Geração automática de sumário ou listas.<br>
                        <br>
                        <strong>REVISÃO FINAL É ESSENCIAL:</strong><br>
                        • Você DEVE revisar o arquivo final após baixar.<br>
                        <br>
                        <strong>SEUS DADOS NÃO SÃO SALVOS:</strong><br>
                        • Se fechar ou recarregar esta página, TODO o conteúdo será PERDIDO.
                    </p>
                    <button id="btn-confirmar-alerta" type="button" class="btn-formatar" style="width:auto;margin:0 auto;max-width:300px;">Estou ciente e desejo continuar</button>
                </div>
            </section>
            <form id="form-abnt" class="hidden">
                <input type="hidden" id="tipo-trabalho" name="tipo-trabalho" value="TCC">
                <div class="campo-grupo">
                    <h3>Informações da Capa</h3>
                    <label for="instituicao">Nome da Instituição:</label>
                    <input type="text" id="instituicao" required>
                    <label for="autor">Nome Completo do Autor:</label>
                    <input type="text" id="autor" required>
                    <label for="titulo">Título do Trabalho:</label>
                    <input type="text" id="titulo" required>
                    <label for="subtitulo">Subtítulo (opcional):</label>
                    <input type="text" id="subtitulo">
                    <label for="cidade">Cidade:</label>
                    <input type="text" id="cidade" value="João Pessoa">
                    <label for="ano">Ano:</label>
                    <input type="number" id="ano" value="2024">
                </div>
                <div class="campo-grupo">
                    <h3>Páginas Opcionais</h3>
                    <label for="dedicatoria">Dedicatória (opcional):</label>
                    <textarea id="dedicatoria"></textarea>
                    <label for="agradecimentos">Agradecimentos (opcional):</label>
                    <textarea id="agradecimentos"></textarea>
                    <label for="epigrafe">Epígrafe (opcional):</label>
                    <textarea id="epigrafe"></textarea>
                </div>
                <div class="campo-grupo" id="folha-aprovacao-grupo">
                    <h3>Folha de Aprovação (opcional)</h3>
                    <label for="banca">Banca Examinadora (nome dos membros, separar por ponto e vírgula):</label>
                    <input type="text" id="banca">
                    <label for="data-aprovacao">Data da aprovação:</label>
                    <input type="text" id="data-aprovacao" placeholder="Ex: 14 de junho de 2024">
                </div>
                <div class="campo-grupo">
                    <h3>Folha de Rosto</h3>
                    <label for="natureza">Natureza do Trabalho:</label>
                    <textarea id="natureza"></textarea>
                    <label for="curso">Curso/Programa:</label>
                    <input type="text" id="curso">
                    <label for="orientador">Nome do Orientador(a):</label>
                    <input type="text" id="orientador">
                </div>
                <div class="campo-grupo">
                    <h3>Elementos Pré-Textuais</h3>
                    <label for="resumo">Resumo (em português):</label>
                    <textarea id="resumo"></textarea>
                    <label for="palavras_chave">Palavras-chave (separadas por ponto):</label>
                    <input type="text" id="palavras_chave">
                    <label for="abstract">Abstract (em língua estrangeira):</label>
                    <textarea id="abstract"></textarea>
                    <label for="keywords">Keywords (separadas por ponto):</label>
                    <input type="text" id="keywords">
                    <label for="listas">Listas (Ilustrações/Tabelas/Siglas/Símbolos, opcional):</label>
                    <textarea id="listas"></textarea>
                </div>
                <div class="campo-grupo" id="grupo-sumario">
                    <h3>Sumário (manual, preencha ou deixe em branco)</h3>
                    <textarea id="sumario" placeholder="O sumário pode ser ajustado manualmente no Word."></textarea>
                </div>
                <div class="campo-grupo">
                    <h3>Elementos Textuais</h3>
                    <label for="introducao">1. Introdução:</label>
                    <textarea id="introducao"></textarea>
                    <label for="objetivos">2. Objetivos:</label>
                    <textarea id="objetivos"></textarea>
                    <label for="justificativa">3. Justificativa:</label>
                    <textarea id="justificativa"></textarea>
                    <label for="hipoteses">4. Hipóteses/Problema de Pesquisa:</label>
                    <textarea id="hipoteses"></textarea>
                    <label for="metodologia">5. Metodologia:</label>
                    <textarea id="metodologia"></textarea>
                    <label for="revisao">6. Revisão de Literatura:</label>
                    <textarea id="revisao"></textarea>
                    <label for="resultados">7. Resultados:</label>
                    <textarea id="resultados"></textarea>
                    <label for="discussao">8. Discussão:</label>
                    <textarea id="discussao"></textarea>
                    <label for="conclusao">9. Conclusão:</label>
                    <textarea id="conclusao"></textarea>
                </div>
                <div class="campo-grupo">
                    <h3>Elementos Pós-Textuais</h3>
                    <label for="referencias">Referências (uma por linha, já em ABNT):</label>
                    <textarea id="referencias"></textarea>
                    <label for="apendices">Apêndices (opcional):</label>
                    <textarea id="apendices"></textarea>
                    <label for="anexos">Anexos (opcional):</label>
                    <textarea id="anexos"></textarea>
                    <label for="glossario">Glossário (opcional):</label>
                    <textarea id="glossario"></textarea>
                </div>
                <button type="submit" class="btn-formatar">Formatar e Baixar .DOCX</button>
            </form>
        </main>
        <footer>
            <p>Gerador ABNT Completo v3.1 – Para revisão e adequação manual final pelo usuário.</p>
        </footer>
    </div>
    <script>
    const tiposComFolhaAprovacao = ["TCC", "Monografia", "Dissertação", "Tese"];

    // 1. Inicial: só mostra escolha do tipo
    document.getElementById('form-abnt').classList.add('hidden');
    document.getElementById('alerta-section').classList.add('hidden');

    let tipoSelecionado = null;

    document.querySelectorAll('.btn-selecao').forEach(btn => {
        btn.addEventListener('click', function() {
            tipoSelecionado = btn.getAttribute('data-tipo');
            document.querySelectorAll('.btn-selecao').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            document.getElementById('tipo-trabalho').value = tipoSelecionado;
            const grupoFolhaAprovacao = document.getElementById('folha-aprovacao-grupo');
            if (tiposComFolhaAprovacao.includes(tipoSelecionado)) {
                grupoFolhaAprovacao.classList.remove('hidden');
            } else {
                grupoFolhaAprovacao.classList.add('hidden');
            }
            // Fluxo: esconde escolha, mostra alerta
            document.getElementById('tipo-trabalho-section').classList.add('hidden');
            document.getElementById('alerta-section').classList.remove('hidden');
        });
    });

    // 2. Confirmação do alerta
    document.getElementById('btn-confirmar-alerta').addEventListener('click', function() {
        document.getElementById('alerta-section').classList.add('hidden');
        document.getElementById('form-abnt').classList.remove('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
    });

    // Modal de carregamento
    function showModal() { document.getElementById('loading-modal').style.display = 'flex'; }
    function hideModal() { document.getElementById('loading-modal').style.display = 'none'; }

    document.getElementById('form-abnt').addEventListener('submit', function(event) {
        event.preventDefault();
        showModal();
        setTimeout(() => {
            gerarDocxAbnt();
        }, 80);
    });

    // ----------- Gerador DOCX -----------
    function getValue(id) { return (document.getElementById(id).value || "").trim(); }

    function gerarDocxAbnt() {
        const { Document, Packer, Paragraph, TextRun, AlignmentType, PageBreak } = docx;
        const tipo = getValue('tipo-trabalho');
        // Dados
        const dados = {
            instituicao: getValue('instituicao').toUpperCase(),
            autor: getValue('autor').toUpperCase(),
            titulo: getValue('titulo').toUpperCase(),
            subtitulo: getValue('subtitulo'),
            cidade: getValue('cidade'),
            ano: getValue('ano'),
            dedicatoria: getValue('dedicatoria'),
            agradecimentos: getValue('agradecimentos'),
            epigrafe: getValue('epigrafe'),
            banca: getValue('banca'),
            dataAprovacao: getValue('data-aprovacao'),
            natureza: getValue('natureza'),
            curso: getValue('curso'),
            orientador: getValue('orientador'),
            resumo: getValue('resumo'),
            palavras_chave: getValue('palavras_chave'),
            abstract: getValue('abstract'),
            keywords: getValue('keywords'),
            listas: getValue('listas'),
            sumario: getValue('sumario'),
            introducao: getValue('introducao'),
            objetivos: getValue('objetivos'),
            justificativa: getValue('justificativa'),
            hipoteses: getValue('hipoteses'),
            metodologia: getValue('metodologia'),
            revisao: getValue('revisao'),
            resultados: getValue('resultados'),
            discussao: getValue('discussao'),
            conclusao: getValue('conclusao'),
            referencias: getValue('referencias'),
            apendices: getValue('apendices'),
            anexos: getValue('anexos'),
            glossario: getValue('glossario')
        };

        // ORGANIZAÇÃO DAS REFERÊNCIAS EM ORDEM ALFABÉTICA
        function ordenarReferencias(refs) {
            return refs.split('\n')
                .map(r => r.trim())
                .filter(r => r.length > 0)
                .sort((a, b) => {
                    // Padrão ABNT: comparar pelo primeiro sobrenome
                    let a1 = a.toUpperCase(), b1 = b.toUpperCase();
                    return a1.localeCompare(b1, 'pt');
                });
        }

        // Helpers para parágrafos
        function makeTitle(text, style = "TituloPrincipal") {
            return new Paragraph({ text: text, style: style });
        }
        function makeSection(text) {
            return new Paragraph({ text: text, style: "TituloSecao" });
        }
        function makeNormal(text) {
            return new Paragraph({ text: text, style: "TextoNormal" });
        }
        function makeBlank(lines = 1) {
            return Array(lines).fill(null).map(() => new Paragraph({ text: "" }));
        }
        // Natureza do trabalho com recuo de 8cm
        function makeNatureza(text) {
            return new Paragraph({
                text: text,
                style: "TextoNormal",
                indent: { left: 4535 }, // 8cm em twips (1cm=567 twips)
                alignment: AlignmentType.JUSTIFIED
            });
        }

        // Elementos do documento
        let docElementos = [];
        // -------- CAPA --------
        docElementos.push(makeTitle(dados.instituicao));
        docElementos.push(...makeBlank(6));
        docElementos.push(makeTitle(dados.autor));
        docElementos.push(...makeBlank(6));
        docElementos.push(makeTitle(dados.titulo, "TituloPrincipal"));
        if(dados.subtitulo) docElementos.push(makeTitle(dados.subtitulo, "Subtitulo"));
        docElementos.push(...makeBlank(12));
        docElementos.push(makeTitle(dados.cidade));
        docElementos.push(makeTitle(dados.ano));
        docElementos.push(new Paragraph({ children: [new PageBreak()] }));

        // -------- FOLHA DE ROSTO --------
        docElementos.push(makeTitle(dados.autor));
        docElementos.push(...makeBlank(6));
        docElementos.push(makeTitle(dados.titulo, "TituloPrincipal"));
        if(dados.subtitulo) docElementos.push(makeTitle(dados.subtitulo, "Subtitulo"));
        docElementos.push(...makeBlank(5));
        if(dados.natureza) docElementos.push(makeNatureza(dados.natureza));
        if(dados.curso) docElementos.push(makeNormal(`Curso: ${dados.curso}`));
        if(dados.orientador) docElementos.push(makeNormal(`Orientador(a): ${dados.orientador}`));
        docElementos.push(...makeBlank(6));
        docElementos.push(makeTitle(dados.cidade));
        docElementos.push(makeTitle(dados.ano));
        docElementos.push(new Paragraph({ children: [new PageBreak()] }));

        // -------- FOLHA DE APROVAÇÃO --------
        if(tiposComFolhaAprovacao.includes(tipo) && (dados.banca || dados.dataAprovacao)) {
            docElementos.push(makeTitle("FOLHA DE APROVAÇÃO", "TituloSecao"));
            docElementos.push(makeNormal(`${dados.titulo}${dados.subtitulo ? ": " + dados.subtitulo : ""}`));
            docElementos.push(...makeBlank(2));
            if(dados.banca) docElementos.push(makeNormal("Banca examinadora: " + dados.banca));
            if(dados.dataAprovacao) docElementos.push(makeNormal("Aprovado em: " + dados.dataAprovacao));
            docElementos.push(...makeBlank(4));
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
        }

        // -------- DEDICATÓRIA / AGRADECIMENTOS / EPÍGRAFE --------
        if(dados.dedicatoria) {
            docElementos.push(makeSection("DEDICATÓRIA"));
            docElementos.push(makeNormal(dados.dedicatoria));
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
        }
        if(dados.agradecimentos) {
            docElementos.push(makeSection("AGRADECIMENTOS"));
            docElementos.push(makeNormal(dados.agradecimentos));
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
        }
        if(dados.epigrafe) {
            docElementos.push(makeSection("EPÍGRAFE"));
            docElementos.push(makeNormal(dados.epigrafe));
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
        }

        // -------- LISTAS --------
        if(dados.listas) {
            docElementos.push(makeSection("LISTAS"));
            docElementos.push(makeNormal(dados.listas));
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
        }

        // -------- SUMÁRIO --------
        docElementos.push(makeSection("SUMÁRIO"));
        docElementos.push(makeNormal(dados.sumario || "(Preencher manualmente no Word. Exclua esta página se desejar.)"));
        docElementos.push(new Paragraph({ children: [new PageBreak()] }));

        // -------- RESUMO + PALAVRAS-CHAVE --------
        docElementos.push(makeSection("RESUMO"));
        docElementos.push(makeNormal(dados.resumo));
        if(dados.palavras_chave) {
            docElementos.push(new Paragraph({
                children: [
                    new TextRun({ text: "Palavras-chave: ", bold: true }),
                    new TextRun(dados.palavras_chave)
                ],
                style: "TextoNormal"
            }));
        }
        docElementos.push(new Paragraph({ children: [new PageBreak()] }));

        // -------- ABSTRACT + KEYWORDS --------
        docElementos.push(makeSection("ABSTRACT"));
        docElementos.push(makeNormal(dados.abstract));
        if(dados.keywords) {
            docElementos.push(new Paragraph({
                children: [
                    new TextRun({ text: "Keywords: ", bold: true }),
                    new TextRun(dados.keywords)
                ],
                style: "TextoNormal"
            }));
        }
        docElementos.push(new Paragraph({ children: [new PageBreak()] }));

        // -------- TEXTO PRINCIPAL --------
        docElementos.push(makeSection("1 INTRODUÇÃO"));
        docElementos.push(makeNormal(dados.introducao));
        docElementos.push(makeSection("2 OBJETIVOS"));
        docElementos.push(makeNormal(dados.objetivos));
        docElementos.push(makeSection("3 JUSTIFICATIVA"));
        docElementos.push(makeNormal(dados.justificativa));
        docElementos.push(makeSection("4 HIPÓTESES / PROBLEMA DE PESQUISA"));
        docElementos.push(makeNormal(dados.hipoteses));
        docElementos.push(makeSection("5 METODOLOGIA"));
        docElementos.push(makeNormal(dados.metodologia));
        docElementos.push(makeSection("6 REVISÃO DE LITERATURA"));
        docElementos.push(makeNormal(dados.revisao));
        docElementos.push(makeSection("7 RESULTADOS"));
        docElementos.push(makeNormal(dados.resultados));
        docElementos.push(makeSection("8 DISCUSSÃO"));
        docElementos.push(makeNormal(dados.discussao));
        docElementos.push(makeSection("9 CONCLUSÃO"));
        docElementos.push(makeNormal(dados.conclusao));
        docElementos.push(new Paragraph({ children: [new PageBreak()] }));

        // -------- REFERÊNCIAS --------
        docElementos.push(makeSection("REFERÊNCIAS"));
        ordenarReferencias(dados.referencias).forEach(ref => {
            docElementos.push(new Paragraph({ text: ref, style: "Referencia" }));
        });

        // -------- APÊNDICES / ANEXOS / GLOSSÁRIO --------
        if(dados.apendices) {
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
            docElementos.push(makeSection("APÊNDICES"));
            docElementos.push(makeNormal(dados.apendices));
        }
        if(dados.anexos) {
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
            docElementos.push(makeSection("ANEXOS"));
            docElementos.push(makeNormal(dados.anexos));
        }
        if(dados.glossario) {
            docElementos.push(new Paragraph({ children: [new PageBreak()] }));
            docElementos.push(makeSection("GLOSSÁRIO"));
            docElementos.push(makeNormal(dados.glossario));
        }

        // --------- Documento ---------
        const doc = new Document({
            sections: [{
                properties: {
                    page: {
                        margin: { top: 1701, right: 1134, bottom: 1134, left: 1701 } // 3cm x 2cm
                    }
                },
                children: docElementos
            }],
            styles: {
                default: {
                    document: { run: { size: 24, font: "Times New Roman" } },
                    paragraph: { spacing: { line: 360 }, indent: { firstLine: 709 } }
                },
                paragraphStyles: [
                    {
                        id: "TituloPrincipal",
                        name: "Título Principal",
                        run: { size: 28, bold: true, font: "Times New Roman", allCaps: true },
                        paragraph: { alignment: AlignmentType.CENTER, spacing: { before: 0, after: 480 } }
                    },
                    {
                        id: "TituloSecao",
                        name: "Título de Seção",
                        run: { size: 24, bold: true, font: "Times New Roman", allCaps: true },
                        paragraph: { alignment: AlignmentType.LEFT, spacing: { before: 240, after: 240 } }
                    },
                    {
                        id: "Subtitulo",
                        name: "Subtítulo",
                        run: { size: 24, italics: true, font: "Times New Roman" },
                        paragraph: { alignment: AlignmentType.CENTER, spacing: { after: 200 } }
                    },
                    {
                        id: "TextoNormal",
                        name: "Texto Normal",
                        run: { size: 24, font: "Times New Roman" },
                        paragraph: { spacing: { line: 360 }, indent: { firstLine: 709 }, alignment: AlignmentType.JUSTIFIED }
                    },
                    {
                        id: "Referencia",
                        name: "Referência",
                        run: { size: 24, font: "Times New Roman" },
                        paragraph: { alignment: AlignmentType.LEFT, spacing: { line: 240, after: 240 }, indent: { firstLine: 0 } }
                    }
                ]
            }
        });

        docx.Packer.toBlob(doc).then(blob => {
            const nomeArquivo = `Trabalho_ABNT_${dados.autor.split(' ')[0] || 'Autor'}.docx`;
            saveAs(blob, nomeArquivo);
            hideModal();
        }).catch((err) => {
            console.error("Erro durante a conversão para Blob:", err);
            hideModal();
            alert("Ocorreu um erro ao gerar o arquivo. Verifique o console (F12).");
        });
    }
    </script>
</body>
</html>
